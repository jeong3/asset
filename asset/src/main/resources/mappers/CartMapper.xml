<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC 	
	"-//mybatis.org//DTD Mapper 3.0//EN" 
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="springBootMVCAsset.mapper.CartMapper">
<update id="cartMerge" parameterType="cartDTO">
merge into cart c	
using (select goods_num from goods where goods_num = #{goodsNum}) g	
on (c.goods_num = g.goods_num and MEMBER_NUM = #{memberNum})	
WHEN MATCHED THEN	
	update set CART_QTY = CART_QTY + #{cartQty}	
WHEN NOT MATCHED THEN	
	insert (cart_NUM
			, MEMBER_NUM,GOODS_NUM,REGIST_DATE, CART_QTY)
	values ((select nvl(max(cart_num),0) + 1  from cart)
			,#{memberNum}, #{goodsNum}, sysdate, #{cartQty})
</update>
</mapper>